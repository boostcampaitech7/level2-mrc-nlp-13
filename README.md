# Level 2 Project :: ODQA(Open-Domain Question Answering) 

### ğŸ“ Abstract
- ì´ í”„ë¡œì íŠ¸ëŠ” ë„¤ì´ë²„ ë¶€ìŠ¤íŠ¸ ìº í”„ AI-Tech 7ê¸° NLP Level 2 ê¸°ì´ˆ í”„ë¡œì íŠ¸ ê²½ì§„ëŒ€íšŒë¡œ, Daconê³¼ Kaggleê³¼ ìœ ì‚¬í•œ ëŒ€íšŒí˜• ë°©ì‹ìœ¼ë¡œ ì§„í–‰ë˜ì—ˆë‹¤.
- ODQA(Open-Domain Question Answering) taskëŠ” ì£¼ì–´ì§„ ì§ˆë¬¸ì— ëŒ€í•´ ëŒ€ê·œëª¨ ë¬¸ì„œ ì§‘í•©ì—ì„œ ê´€ë ¨ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê³ , ê·¸ ì •ë³´ë¡œë¶€í„° ì •í™•í•œ ë‹µë³€ì„ ì¶”ì¶œí•˜ëŠ” ê²ƒì´ ì£¼ì œë¡œ, ëª¨ë“  íŒ€ì›ì´ ë°ì´í„° ì „ì²˜ë¦¬ë¶€í„° ì•™ìƒë¸”ê¹Œì§€ AI ëª¨ë¸ë§ì˜ ì „ ê³¼ì •ì„ í•¨ê»˜ í˜‘ì—…í–ˆë‹¤.

<br>

## Project Leader Board 
- Public Leader Board
<img width="450" alt="public_leader_board" src="https://github.com/user-attachments/assets/4d4592bc-1e3e-4455-8de9-cf61e5fc6d50">

- Private Leader Board 
<img width="450" alt="private_leader_board" src="https://github.com/user-attachments/assets/f1a5b53d-f30b-4d87-8a14-3cc1a602f8a0">

- [ğŸ“ˆ NLP 13ì¡° Project Wrap-Up report ì‚´í´ë³´ê¸°](https://github.com/user-attachments/files/17182231/NLP_13.Wrap-Up.pdf
)

<br>

## ğŸ§‘ğŸ»â€ğŸ’» Team Introduction & Members 

> Team name : ìŠ¤ë¹ˆë¼í‚¨ìŠ¤ë°° [ NLP 13ì¡° ]

### ğŸ‘¨ğŸ¼â€ğŸ’» Members
ê¶Œì§€ìˆ˜|ê¹€ì„±ì€|ê¹€íƒœì›|ì´í•œì„œ|ì •ì£¼í˜„|
:-:|:-:|:-:|:-:|:-:
<img src='https://github.com/user-attachments/assets/ab4b7189-ec53-41be-8569-f40619b596ce' height=125 width=100></img>|<img src='https://github.com/user-attachments/assets/49dc0e59-93ee-4e08-9126-4a3deca9d530' height=125 width=100></img>|<img src='https://github.com/user-attachments/assets/a15b0f0b-cd89-412b-9b3d-f59eb9787613' height=125 width=100></img>|<img src='https://github.com/user-attachments/assets/11b2ed88-bf94-4741-9df5-5eb2b9641a9b' height=125 width=100></img>|<img src='https://github.com/user-attachments/assets/3e2d2a7e-1c64-4cb7-97f6-a2865de0c594' height=125 width=100></img>
[Github](https://github.com/Kwon-Jisu)|[Github](https://github.com/ssungni)|[Github](https://github.com/chris40461)|[Github](https://github.com/beaver-zip)|[Github](https://github.com/peter520416)
<a href="mailto:wltn80609@ajou.ac.kr" target="_blank"><img src="https://img.shields.io/badge/Gmail-EA4335?style&logo=Gmail&logoColor=white"/></a>|<a href="mailto:sunny020111@ajou.ac.kr" target="_blank"><img src="https://img.shields.io/badge/Gmail-EA4335?style&logo=Gmail&logoColor=white"/></a>|<a href="mailto:chris40461@gmail.com" target="_blank"><img src="https://img.shields.io/badge/Gmail-EA4335?style&logo=Gmail&logoColor=white"/></a>|<a href="mailto:beaver.zip@gmail.com" target="_blank"><img src="https://img.shields.io/badge/Gmail-EA4335?style&logo=Gmail&logoColor=white"/></a>|<a href="mailto:peter520416@gmail.com" target="_blank"><img src="https://img.shields.io/badge/Gmail-EA4335?style&logo=Gmail&logoColor=white"/></a>|

### ğŸ§‘ğŸ»â€ğŸ”§ Members' Role

| ì´ë¦„ | ì—­í•  |
| :---: | --- |
| **`ê¶Œì§€ìˆ˜`** | **EDA** (ë¼ë²¨ ë¶„í¬ ë°ì´í„°ë¶„ì„), **ëª¨ë¸ íƒìƒ‰** (KLUE: ë…¼ë¬¸ ë°”íƒ•ìœ¼ë¡œ RoBERTaì™€ ELECTRA ê³„ì—´ ëª¨ë¸ ì¤‘ì‹¬ìœ¼ë¡œ íƒìƒ‰), **ëª¨ë¸ ì‹¤í—˜** (team-lucid/deberta-v3-base-korean), **Ensemble ì‹¤í—˜** (output í‰ê·  ë° ê°€ì¤‘ì¹˜ í™œìš©) |
| **`ê¹€ì„±ì€`** | **EDA** (ë¼ë²¨ ë¶„í¬ ë°ì´í„°ë¶„ì„), **ëª¨ë¸ íƒìƒ‰** (Encoder, Decoder, Encoder - Decoder ëª¨ë¸ë¡œ ì„¸ë¶„í™”í•˜ì—¬ íƒìƒ‰), **ëª¨ë¸ ì‹¤í—˜** (snunlp-KR-ELECTRA), **Ensemble ì‹¤í—˜** (output í‰ê·  ë° ê°€ì¤‘ì¹˜ í™œìš©) |
| **`ê¹€íƒœì›`** | **ëª¨ë¸ ì‹¤í—˜** (KR-ELECTRA-discriminator, electra-kor-base, deberta-v3, klue-roberta ), **ë°ì´í„° ì¦ê°•** (label rescaling(0ì  ì¸ë±ìŠ¤ì˜ ì œê±° ë° 5ì  ì¸ë±ìŠ¤ ì¶”ê°€), ë‹¨ìˆœ ë³µì œ ë°ì´í„° ì¦ê°•(1ì ~3ì  ì¸ë±ìŠ¤), train ë°ì´í„°ì˜ ì „ì²´ì ì¸ ë§ì¶¤ë²• êµì •/ë¶ˆìš©ì–´ ì œê±°/ë„ì–´ì“°ê¸° êµì •), **ëª¨ë¸ Ensemble** (weighted sum for 3model/4models) |
| **`ì´í•œì„œ`** |**ë°ì´í„° ì¦ê°•**(ì¡°ì‚¬ ëŒ€ì²´, Label ë¶„í¬ ê· í˜•í™”), **ëª¨ë¸ ì‹¤í—˜**(team-lucid/deberta-v3-base-korean, monologg/koelectra-base-v3-discriminator, snunlp/KR-ELECTRA), Hyperparameter Tuning(Optuna Template ì œì‘ ë° ì‹¤í—˜)|
| **`ì •ì£¼í˜„`** &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | **ë°ì´í„° EDA** (Label ë¶„í¬, ë¬¸ì¥ ë‚´ì˜ ë‹¨ì–´ ë¹ˆë„), **ë°ì´í„° ì¦ê°•** (Swap sentence1 and sentence2, ìœ ì˜ì–´ êµì²´(â€˜ë„ˆë¬´â€™, â€˜ì§„ì§œâ€™, â€˜ì •ë§â€™)), **ëª¨ë¸ ì„ ì • ë° Ensemble** (T5-base-korean-summarization), Ensemble(Blending Ensemble for 3 or 4 model(meta model = Ridge)) |

<br>

## ğŸ–¥ï¸ Project Introduction 


|**í”„ë¡œì íŠ¸ ì£¼ì œ**| **Open-Domain Question Answering: ** ì‚¬ì „ì— êµ¬ì¶•ë˜ì–´ìˆëŠ” Knowledge resource ì—ì„œ ì§ˆë¬¸ì— ëŒ€ë‹µí•  ìˆ˜ ìˆëŠ” ë¬¸ì„œë¥¼ ì°¾ëŠ” NLP Task|
| :---: | --- |
|**í”„ë¡œì íŠ¸ êµ¬í˜„ë‚´ìš©**| 1. Hugging Face ì˜ Pretrained ëª¨ë¸ê³¼ STS ë°ì´í„°ì…‹ì„ í™œìš©í•´ ë‘ ë¬¸ì¥ì˜ 0 ê³¼ 5 ì‚¬ì´ì˜ ìœ ì‚¬ë„ë¥¼ ì¸¡ì •í•˜ëŠ” AI ëª¨ë¸ì„ êµ¬ì¶• <br>2. ë¦¬ë”ë³´ë“œ í‰ê°€ì§€í‘œì¸ í”¼ì–´ìŠ¨ ìƒê´€ ê³„ìˆ˜(Pearson Correlation Coefficient ,PCC)ì—ì„œ ë†’ì€ ì ìˆ˜(1ì— ê°€ê¹Œìš´ ì ìˆ˜)ì— ë„ë‹¬í•  ìˆ˜ ìˆë„ë¡ ë°ì´í„° ì „ì²˜ë¦¬, ì¦ê°•, í•˜ì´í¼ íŒŒë¼ë¯¸í„° íŠœë‹ì„ ì§„í–‰|
|**ê°œë°œ í™˜ê²½**|**â€¢ `GPU` :** Tesla V100 ì„œë²„ 4ê°œ (RAM32G)<br> **â€¢ `ê°œë°œ Tool` :** Jupyter notebook, VS Code [ì„œë²„ SSHì—°ê²°]
|**í˜‘ì—… í™˜ê²½**|**â€¢ `Github Repository` :** Baseline ì½”ë“œ ê³µìœ  ë° ë²„ì „ ê´€ë¦¬, ê°œì¸ branchë¥¼ ì‚¬ìš©í•´ ì‘ì—…ìƒí™© ê³µìœ  <br>**â€¢ `Notion` :** STS í”„ë¡œì íŠ¸ í˜ì´ì§€ë¥¼ í†µí•œ ì—­í• ë¶„ë‹´, ì‹¤í—˜ ê°€ì„¤ ì„¤ì • ë° ê²°ê³¼ ê³µìœ  <br>**â€¢ `SLACK, Zoom` :** ì‹¤ì‹œê°„ ëŒ€ë©´/ë¹„ëŒ€ë©´ íšŒì˜|

<br>

## ğŸ“ Project Structure

### ğŸ—‚ï¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° ì„¤ëª…
- í•™ìŠµ ë°ì´í„° ê²½ë¡œ:Â `./data`
- í•™ìŠµ ë©”ì¸ ì½”ë“œ: `./train.py`
- í•™ìŠµ ë°ì´í„°ì…‹ ê²½ë¡œ: `./data/train_dataset/train`
- í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ ê²½ë¡œ: `./data/train_dataset/validation`

### ğŸ“„ ì½”ë“œ êµ¬ì¡° ì„¤ëª…

> script íŒŒì¼ì„ ìƒì„±í•˜ì—¬, í•˜ì´í¼ íŒŒë¼ë¯¸í„°ì˜ ì¡°ì • ë° train,test,ensemble ì„ ìš©ì´í•˜ê²Œ í–ˆë‹¤.

- **Dense Retriever Train** : `dense_train.py`
- **Train** : `train.sh`
- **Predict** : `test.sh`
- **Ensemble** : `softvoting.py`
- **ìµœì¢… ì œì¶œ íŒŒì¼** : `./ensemble/predictions.json`

```
ğŸ“¦ base
â”£ ğŸ“‚ dense_model
â”£ ğŸ“‚ ensemble
â”ƒ â”— diff.py
â”£ ğŸ“‚ models
â”£ ğŸ“‚ nbest
â”£ arguments.py
â”£ dense_encoder.py
â”£ dense_train.py
â”£ dense_util.py
â”£ eval.sh
â”£ inference.py
â”£ requirements.txt
â”£ retrieval.py
â”£ softvoting.py
â”£ test.sh
â”£ train.py
â”£ train.sh
â”£ trainer_qa.py
â”— utils_qa.py
 ```
<br>

## ğŸ“ Project Ground Rule
>íŒ€ í˜‘ì—…ì„ ìœ„í•´ í”„ë¡œì íŠ¸ ê´€ë ¨ Ground Ruleì„ ì„¤ì •í•˜ì—¬ í”„ë¡œì íŠ¸ê°€ ì›í™œí•˜ê²Œ ëŒì•„ê°ˆ ìˆ˜ ìˆë„ë¡ ê·œì¹™ì„ ì •í–ˆìœ¼ë©°, ë‚ ì§œ ë‹¨ìœ„ë¡œ ê°„ëµí•œ ëª©í‘œë¥¼ ì„¤ì •í•˜ì—¬ í˜‘ì—…ì„ ì›í™œí•˜ê²Œ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ ê³„íší•˜ì—¬ ì§„í–‰í–ˆë‹¤.

**- a. `Server ê´€ë ¨`** : ê¶Œì§€ìˆ˜, ê¹€ì„±ì€, ì´í•œì„œ, ì •ì£¼í˜„ ìº í¼ëŠ” ê°ì ì„œë²„ë¥¼ ìƒì„±í•´ ëª¨ë¸ ì‹¤í—˜ì„ ì§„í–‰í•˜ê³ , ê¹€íƒœì› ìº í¼ëŠ” ì„œë²„ê°€ ìœ íœ´ ìƒíƒœì¸ ì„œë²„ì—ì„œ ì‹¤í—˜ì„ ì§„í–‰í–ˆë‹¤.

**- b. `Git ê´€ë ¨`** : ê°ì branch ìƒì„±í•´ ì‘ì—…í•˜ê³ , ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•  íŒŒì¼ì€ mainì— push í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ í˜‘ì—…í–ˆë‹¤.

**- c. `Submission ê´€ë ¨`** : ëŒ€íšŒ ë§ˆê° 2ì¼ ì „ê¹Œì§€ëŠ” ììœ ë¡­ê²Œ ì œì¶œí–ˆê³ , 2ì¼ ì „ë¶€í„°ëŠ” ì¸ë‹¹ 2íšŒì”© ë¶„ë°°í–ˆë‹¤.

**- d. `Notion ê´€ë ¨`** : ì›í™œí•œ ì•„ì´ë””ì–´ ë¸Œë ˆì¸ìŠ¤í† ë°ê³¼ ë¶„ì—…ì„ ìœ„í•´ íšŒì˜ë¥¼ í•  ê²½ìš° ë…¸ì…˜ì— ê¸°ë¡í•˜ë©°, ì—°êµ¬ ë° ì‹¤í—˜ê²°ê³¼ì˜ ê¸°ë¡ì„ ê³µìœ í–ˆë‹¤.

<br>

## ğŸ—“ Project Procedure: ì´ 14ì¼ ì§„í–‰
- **`(1~3 ì¼ì°¨)`**: EDA ë¶„ì„
- **`(3~5 ì¼ì°¨)`**: ë°ì´í„° ì „ì²˜ë¦¬
- **`(6~11 ì¼ì°¨)`** : ë°ì´í„° ì¦ê°•
- **`(7~12 ì¼ì°¨)`** : ëª¨ë¸ë§ ë° íŠœë‹
- **`(11~13 ì¼ì°¨)`** : ì•™ìƒë¸”

* ì•„ë˜ëŠ” ì €í¬ í”„ë¡œì íŠ¸ ì§„í–‰ê³¼ì •ì„ ë‹´ì€ Ganttì°¨íŠ¸ ì…ë‹ˆë‹¤. 
<img width="800" alt="Gantt" src="https://github.com/user-attachments/assets/23c3dacb-95c7-49c0-88df-ebc5b5f9b1a7">

<br>

## **MRC**
* ìš°ë¦¬ëŠ” ë¨¼ì € Retriever - Reader ëª¨ë¸ì„ êµ¬í˜„í•˜ê¸°ì— ì•ì„œ, KorQuad data ì— ëŒ€í•´ì„œ pre-trained ëœ ëª¨ë¸ì„ ì‚¬ìš©í•´, ë¶€ì¡±í•œ Train dataset ì„ ë³´ê°•í•˜ì—¬ í•™ìŠµí•˜ê¸°ë¡œ í•˜ì˜€ë‹¤.
<br>

## **Retriever**
* Retriever ëª¨ë¸ì˜ ê²½ìš°, KorQuad data ë¥¼ í†µí•´ question, passage embedding ì„ ë¯¸ë¦¬ í•™ìŠµí•˜ëŠ” ê³¼ì •ì„ ê°€ì§„ Dense Retriever ê³¼, BM25 ë¥¼ ì‚¬ìš©í•œ Sparse Retriever ì„ ê²°í•©í•œ Hybrid Retriever ì„ ì‚¬ìš©í–ˆë‹¤.
* Hybrid Retriever ì„ í•˜ëŠ” ë°©ì‹ì€ í¬ê²Œ 3ê°€ì§€ ì¸ë°, ì´ 3ê°€ì§€ë¥¼ ëª¨ë‘ í™œìš©í•˜ì—¬ passage ì™€ question ì˜ ì—°ê´€ì„±ì„ ìµœëŒ€ë¡œ í•™ìŠµí•˜ê³ , ì‚¬ìš©í•˜ê³ ì í•˜ì˜€ë‹¤.

| **Score Function Type**                       | **Description**                                                                                        |
|-------------------------------------------|-----------------------------------------------------------------------------------------------------|
| **1. Î» x Dense Similarity + BM25 Score** | Dense Retrieverì™€ BM25 ì ìˆ˜ë¥¼ ê²°í•©í•˜ì—¬ ì§ˆë¬¸ê³¼ ë¬¸ì„œ ê°„ì˜ ê´€ê³„ë¥¼ ê°•í™”í•©ë‹ˆë‹¤. Î»ëŠ” ë‘ ì ìˆ˜ ê°„ì˜ ê°€ì¤‘ì¹˜ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤. |
| **2. Reciprocal Rank Fusion (RRF)**      | ì—¬ëŸ¬ Retrieverì˜ ë­í‚¹ì„ ê¸°ë°˜ìœ¼ë¡œ ê° ë¬¸ì„œì˜ reciprocal rankë¥¼ í•©ì‚°í•˜ì—¬ ìµœì¢… ì ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. |
| **3. (Î» x Dense Similarity + BM25 Score) â†’ ko-reranker** | 1ë²ˆì˜ Score ë¥¼ í•œêµ­ì–´ re-rankerì— ì…ë ¥í•˜ì—¬ ìµœì¢… ë­í‚¹ì„ ì •ì œí•˜ê³  ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.     |
<br>

## **Ensemble Model**

* ìµœì¢…ì ìœ¼ë¡œ 3ê°œì˜ json íŒŒì¼ì„ softvoting ê¸°ë²•ì„ í™œìš©í•˜ì—¬ ì‚¬ìš©í–ˆí–ˆë‹¤.

| **File Name**                             | **Score Function**                                   |
|-------------------------------------------|-----------------------------------------------------|
| nbest_predictions_op1.json               | Î» x Dense Similarity + BM25 Score                   |
| nbest_predictions_op2.json               | Reciprocal Rank Fusion (RRF)                        |
| nbest_predictions_op3.json               | (Î» x Dense Similarity + BM25 Score) â†’ ko-reranker   |

<br>

## ğŸ’» Getting Started

### âš ï¸  How To install Requirements
```bash
# í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
pip install -r requirements.txt
```

### âŒ¨ï¸ How To Train & Test
```bash
#ë°ì´í„° ì¦ê°•
python3 augmentation.py
# train.py ì½”ë“œ ì‹¤í–‰ : ëª¨ë¸ í•™ìŠµì„ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰
# ì´í›„ test.py ì½”ë“œë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ test
# config.yaml ë‚´ ëª¨ë¸ ì´ë¦„, lr ì„ ë¦¬ìŠ¤íŠ¸ ìˆœì„œëŒ€ë¡œ ë³€ê²½í•˜ë©° train ìœ¼ë¡œ í•™ìŠµ

#plm_name[0], lr[0] -> klue/roberta-base
python3 train.py
python3 test.py

#plm_name[1], lr[1] -> kykim/electra-kor-base
python3 train.py
python3 test.py

#plm_name[2], lr[2] -> team-lucid/deberta-v3-base-korean 
python3 train.py
python3 test.py

#plm_name[3], lr[3] -> snunlp/KR-ELECTRA-discriminator
python3 train.py
python3 test.py

#plm_name[4], lr[4] -> eenzeenee/t5-base-korean- summarization
python3 train.py
python3 test.py

```

### âŒ¨ï¸ How To Ensemble
```bash
# ìˆœì°¨ì ìœ¼ë¡œ weighted ensemble ì§„í–‰ í›„, ì¶œë ¥ ê²°ê³¼ë¥¼ ì‚¬ìš©í•´ì„œ blended ensemble ì§„í–‰
python3 weighted_ensemble.py # klue/roberta-base, eenzeenee/t5-base-korean-summarization, kykim/electra-kor-base
python3 blending_ensemble.py # kykim/electra-kor-base , team-lucid/deberta-v3-base-korean , snunlp/KR-ELECTRA-discriminator, weighted_ensemble
```
